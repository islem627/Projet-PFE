<div class="container-scroller">
  <!-- Header -->
  <app-header>
    <button class="home-btn btn btn-outline-light" routerLink="/">
      <i class="fas fa-home"></i>
    </button>
  </app-header>

  <!-- Sidebar + Main Content Wrapper -->
  <div class="container-fluid page-body-wrapper">
    <div class="row w-100 m-0">
      
      <!-- Sidebar -->
      <div class="col-md-2 col-lg-2 px-0">
        <app-sidebar></app-sidebar>
      </div>

      <!-- Main Content -->
      <div class="col-md-10 col-lg-10 px-4">
        <div class="main-panel">
          <div class="content-wrapper">
            
            <!-- Title -->
            <h2 class="page-title">Destination Manager</h2>

            <!-- Search Bar & Add Button -->
            <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
              <input type="text" class="form-control w-50 me-3 mb-2"
                     placeholder="Search destinations..."
                     [(ngModel)]="searchTerm"
                     (input)="filterDestinations()">

              <button class="btn btn-primary mb-2" (click)="openAddForm()">
                <i class="fas fa-plus"></i> Add Destination
              </button>
            </div>

            <!-- Map -->
            <div class="card mb-4">
              <div class="card-body">
                <div id="destinationMap" style="height: 400px;"></div>
              </div>
            </div>

            <!-- Destination Cards Grid -->
            <div class="row">
              <div class="col-md-4 mb-3" *ngFor="let dest of filteredDestinations">
                <div class="card h-100">
                  <div class="card-body">
                    <h5 class="card-title">{{ dest.city }}</h5>
                    <p><strong>Address:</strong> {{ dest.address }}</p>
                    <p><strong>Fee:</strong> {{ dest.deliveryFee }} TND</p>
                    <p><strong>Status:</strong>
                      <span class="badge"
                            [class.bg-success]="dest.status === 'Active'"
                            [class.bg-secondary]="dest.status === 'Inactive'">
                        {{ dest.status }}
                      </span>
                    </p>
                  </div>
                  <div class="card-footer d-flex justify-content-between">
                    <button class="btn btn-sm btn-primary edit-btn" (click)="openEditForm(dest)">Edit</button>
                    <button class="btn btn-sm btn-danger delete-btn" (click)="deleteDestination(dest.id)">Delete</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modal Form -->
            <div *ngIf="isFormOpen" class="modal-overlay">
              <div class="modal-container">
                <h5 class="modal-title">{{ isEditMode ? 'Edit Destination' : 'Add New Destination' }}</h5>
                <form [formGroup]="destinationForm" (ngSubmit)="handleSubmit()">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Name</label>
                      <input type="text" formControlName="address" class="form-control">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">City</label>
                      <select formControlName="city" class="form-control">
                        <option *ngFor="let city of tunisianCities" [value]="city">{{ city }}</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Latitude</label>
                      <input type="number" formControlName="lat" class="form-control">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Longitude</label>
                      <input type="number" formControlName="lng" class="form-control">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Delivery Fee (TND)</label>
                      <input type="number" formControlName="deliveryFee" class="form-control">
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Status</label>
                      <select formControlName="status" class="form-control">
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-actions mt-4 text-end">
                    <button type="button" class="btn btn-outline-secondary me-2" (click)="closeForm()">Cancel</button>
                    <button type="submit" class="btn btn-primary" [disabled]="destinationForm.invalid">
                      {{ isEditMode ? 'Update' : 'Create' }}
                    </button>
                  </div>
                </form>
              </div>
            </div>

          </div> <!-- content-wrapper -->
        </div> <!-- main-panel -->
      </div> <!-- col -->

    </div> <!-- row -->
  </div> <!-- page-body-wrapper -->
</div> <!-- container-scroller -->
